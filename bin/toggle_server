#!/usr/bin/env bash

PLUGIN_PATH="$TMUX_PLUGIN_MANAGER_PATH/tcp-relay-plugin"
SESSION="$(tmux display-message -p '#S')"  # å–å¾—ç›®å‰ session åç¨±
WIN="tcp_relay"
PIDFILE="$HOME/.tmux_tcp_relay.pid"
SCRIPT="$PLUGIN_PATH/tcp-relay.py"
ARGS=$(tmux show-option -gqv "@tcp-relay-args")

create_window() {
  tmux new-window -d -t "${SESSION}:" -n "$WIN" "python3  ${SCRIPT}"
  #tmux new-window -d -t "${SESSION}:" -n "$WIN" "python3  ~/.tmux/plugins/tcp-relay-plugin/tcp-relay.py"
  #tmux new-window -d -t "${SESSION}:" -n "$WIN" "python3 ${SCRIPT}"
}

toggle() {
  if [[ -f "$PIDFILE" ]]; then
    tmux kill-window -t "${SESSION}:$WIN"
    rm "$PIDFILE"
    tmux display-message "ðŸ”´ tcp-relay-plugin: window removed"
  else
    create_window
    tmux display-message "ðŸŸ¢ tcp-relay-plugin: window created"
    echo "$SESSION:$WIN" > "$PIDFILE"
    # è‡ªå‹•åˆ‡åˆ°è©² window
    tmux select-window -t "${SESSION}:$WIN"
  fi
}
toggle
